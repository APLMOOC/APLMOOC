
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/favicon.svg">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-8.5.6">
    
    
      
        <title>3.4 - Computer Graphics - APL MOOC</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CAPL385:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"APL385"}</style>
      
    
    
      <link rel="stylesheet" href="../../../styles/main.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="purple" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#computer-graphics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="APL MOOC" class="md-header__button md-logo" aria-label="APL MOOC" data-md-component="logo">
      
  <img src="../../assets/apl.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            APL MOOC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3.4 - Computer Graphics
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="purple" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../ch0/part1/" class="md-tabs__link md-tabs__link--active">
        Course
      </a>
    </li>
  

  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../credits/" class="md-tabs__link">
      Receiving ECTS Credits
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../login/" class="md-tabs__link">
      Log in
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="APL MOOC" class="md-nav__button md-logo" aria-label="APL MOOC" data-md-component="logo">
      
  <img src="../../assets/apl.svg" alt="logo">

    </a>
    APL MOOC
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Course
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Course" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Course
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          0 - The wonderful world of APL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="0 - The wonderful world of APL" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          0 - The wonderful world of APL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch0/part1/" class="md-nav__link">
        0.1 - Quirky and different
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch0/part2/" class="md-nav__link">
        0.2 - What's the big idea?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch0/part3/" class="md-nav__link">
        0.3 - Useful resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch0/part4/" class="md-nav__link">
        0.4 - About the course
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          1 - Getting your toes wet
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="1 - Getting your toes wet" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          1 - Getting your toes wet
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch1/part1/" class="md-nav__link">
        1.1 - Immediate execution mode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch1/part2/" class="md-nav__link">
        1.2 - Basic operations and input
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch1/part3/" class="md-nav__link">
        1.3 - How do I type these characters?!?!?!?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch1/part4/" class="md-nav__link">
        1.4 - Order of execution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch1/part5/" class="md-nav__link">
        1.5 - When things go wrong
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch1/summary/" class="md-nav__link">
        1.S - Summary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch1/read/" class="md-nav__link">
        1.R - Read exercises
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch1/write/" class="md-nav__link">
        1.W - Write exercises
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          2 - Variables, scalars, vectors, matrices
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="2 - Variables, scalars, vectors, matrices" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          2 - Variables, scalars, vectors, matrices
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch2/part1/" class="md-nav__link">
        2.1 - Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch2/part2/" class="md-nav__link">
        2.2 - Higher dimensional space
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch2/part3/" class="md-nav__link">
        2.3 - Arithmetic operations on vectors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch2/part4/" class="md-nav__link">
        2.4 - Nested arrays
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch2/part5/" class="md-nav__link">
        2.5 - A Musical Interlude
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch2/summary/" class="md-nav__link">
        2.S - Summary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch2/read/" class="md-nav__link">
        2.R - Read exercises
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ch2/write/" class="md-nav__link">
        2.W - Write exercises
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4">
          3 - Functions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="3 - Functions" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          3 - Functions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../part1/" class="md-nav__link">
        3.1 - Fun for Everyone
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../part2/" class="md-nav__link">
        3.2 - All the Math
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../part3/" class="md-nav__link">
        3.3 - All Aboard
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        3.4 - Computer Graphics
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../summary.md" class="md-nav__link">
        2.S - Summary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../read.md" class="md-nav__link">
        2.R - Read exercises
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../write.md" class="md-nav__link">
        2.W - Write exercises
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../credits/" class="md-nav__link">
        Receiving ECTS Credits
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../login/" class="md-nav__link">
        Log in
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="computer-graphics">Computer Graphics</h1>
<p>Did you know APL was used to make graphics for the original TRON movie? Judson Rosebush, one of the founders of the computer animation studio Digital Effects, developed "Visions"; a library of APL functions intended for generating computer graphics. It allowed the manipulation of polygons in three-dimensional space and compute perspective transformations.
The company created several animated sequences for the movie, including animating the polyhedral character "Bit" who could only convey one bit of information, answering yes or no questions.</p>
<div style="display:flex; flex-direction: row;">
<img src="../../assets/bitno.jpg" style="width:50%; margin-left: 0; margin-right: auto;" />
<img src="../../assets/bit.jpg" style="width:50%; margin-left: auto; margin-right: auto;" />
<img src="../../assets/bityes.jpg" style="width:50%; margin-left: auto; margin-right: 0;" />
</div>

<p>Here's a quote from Jeffrey Kleinster, one of the co-founders of Digital Effects, in an interview published in “CG 101”:
"Our original setup was a 1200-baud modem connection to an Amdahl V6 running A Programming language (APL) in Bethesda, Maryland, using a Tektronix display to preview wireframes. (Polygons refreshed at one per second—that's one polygon per second!)…"</p>
<p>In this section, we will write our own ray marcher to render out 3D environments entirely in APL. The advantages of an array-based language for computer graphics will be immediately seen.</p>
<hr />
<p>In very simple terms, light rays travel from light sources, potentially reflecting off of surfaces, some of which eventually reach light detectors. For example, when admiring a nice forest view, rays of light from the sun get absorbed and emitted at different frequencies by leaves, some of which then make their way to your retina.</p>
<p>The only rays of light that affect the final image are the ones which finally reach detectors. For the purposes of computation, light rays are usually traced from from detectors to the sources. This is entirely equivalent to tracing light from sources to detectors, as long as the assumptions of geometric optics hold, which are almost universally assumed in computer graphics.</p>
<p>The procedure we will use is as follows. We place a camera at a certain position relative to a 3D environment, and send out rays from the camera for every pixel in the final rendered image in the direction of that pixel. We then calculate the intersection of each of our rays with the environment, and get the directions from the points to the light source of our scene. We finally calculate the shading for the specific points of the environment, by comparing the vector orthogonal to the surface at that point, the normal vector, to the direction of the light source. We will ignore lighting falloff and shadows in our rendering for simplicity.</p>
<p><img src="../../assets/raymarchscene.png" style="margin-left: auto; margin-right: auto; display: block;" /></p>
<p>For the first step, we create a vector called camera which stores the camera position. We refer to the first coordinate as the x coordinate, the second as the y coordinate, and the third as the z coordinate. We imagine the camera is facing the positive z direction, towards (0 0 1).</p>
<div class="highlight"><pre><span></span><code><span class="nv">camera</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">¯10</span><span class="w"></span>
</code></pre></div>
<p>We then create an array to hold pixel coordinates, in this case a 300×300 image.</p>
<div class="highlight"><pre><span></span><code><span class="w">       </span><span class="o">⍳</span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"></span>
<span class="err">┌────┬────┬────┬────┬────┬────┬────┬────┬────┬─────┐</span><span class="w"></span>
<span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">├────┼────┼────┼────┼────┼────┼────┼────┼────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="err">│</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="err">│</span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="err">│</span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="err">│</span><span class="m">2</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="err">│</span><span class="m">2</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="err">│</span><span class="m">2</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="err">│</span><span class="m">2</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="err">│</span><span class="m">2</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">├────┼────┼────┼────┼────┼────┼────┼────┼────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="err">│</span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="err">│</span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="err">│</span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="err">│</span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="err">│</span><span class="m">3</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="err">│</span><span class="m">3</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="err">│</span><span class="m">3</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="err">│</span><span class="m">3</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">├────┼────┼────┼────┼────┼────┼────┼────┼────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">4</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="err">│</span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="err">│</span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="err">│</span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="err">│</span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="err">│</span><span class="m">4</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="err">│</span><span class="m">4</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="err">│</span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="err">│</span><span class="m">4</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">├────┼────┼────┼────┼────┼────┼────┼────┼────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="err">│</span><span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="err">│</span><span class="m">5</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="err">│</span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="err">│</span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="err">│</span><span class="m">5</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="err">│</span><span class="m">5</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="err">│</span><span class="m">5</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="err">│</span><span class="m">5</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">├────┼────┼────┼────┼────┼────┼────┼────┼────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">6</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">6</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="err">│</span><span class="m">6</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="err">│</span><span class="m">6</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="err">│</span><span class="m">6</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="err">│</span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="err">│</span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="err">│</span><span class="m">6</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="err">│</span><span class="m">6</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="err">│</span><span class="m">6</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">├────┼────┼────┼────┼────┼────┼────┼────┼────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">7</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">7</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="err">│</span><span class="m">7</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="err">│</span><span class="m">7</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="err">│</span><span class="m">7</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="err">│</span><span class="m">7</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="err">│</span><span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="err">│</span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="err">│</span><span class="m">7</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="err">│</span><span class="m">7</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">├────┼────┼────┼────┼────┼────┼────┼────┼────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">8</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="err">│</span><span class="m">8</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="err">│</span><span class="m">8</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="err">│</span><span class="m">8</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="err">│</span><span class="m">8</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="err">│</span><span class="m">8</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="err">│</span><span class="m">8</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="err">│</span><span class="m">8</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="err">│</span><span class="m">8</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">├────┼────┼────┼────┼────┼────┼────┼────┼────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">9</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">9</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="err">│</span><span class="m">9</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="err">│</span><span class="m">9</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="err">│</span><span class="m">9</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="err">│</span><span class="m">9</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="err">│</span><span class="m">9</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="err">│</span><span class="m">9</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="err">│</span><span class="m">9</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="err">│</span><span class="m">9</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">├────┼────┼────┼────┼────┼────┼────┼────┼────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">10</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="m">10</span><span class="w"> </span><span class="m">2</span><span class="err">│</span><span class="m">10</span><span class="w"> </span><span class="m">3</span><span class="err">│</span><span class="m">10</span><span class="w"> </span><span class="m">4</span><span class="err">│</span><span class="m">10</span><span class="w"> </span><span class="m">5</span><span class="err">│</span><span class="m">10</span><span class="w"> </span><span class="m">6</span><span class="err">│</span><span class="m">10</span><span class="w"> </span><span class="m">7</span><span class="err">│</span><span class="m">10</span><span class="w"> </span><span class="m">8</span><span class="err">│</span><span class="m">10</span><span class="w"> </span><span class="m">9</span><span class="err">│</span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="err">│</span><span class="w"></span>
<span class="err">└────┴────┴────┴────┴────┴────┴────┴────┴────┴─────┘</span><span class="w"></span>
<span class="w">       </span><span class="nv">pxl_coords</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⍳</span><span class="m">300</span><span class="w"> </span><span class="m">300</span><span class="w"></span>
</code></pre></div>
<p>If we picture the image as being in front of the camera, with the camera facing the center of the image, we divide the values by the width/height, and shift them so that the vector 0 0 is at the center.</p>
<div class="highlight"><pre><span></span><code><span class="w">       </span><span class="p">(</span><span class="o">⍳</span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="o">÷</span><span class="m">5</span><span class="w"></span>
<span class="err">┌───────┬───────┬───────┬───────┬─────┐</span><span class="w"></span>
<span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">0.2</span><span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">0.4</span><span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">0.6</span><span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">0.8</span><span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="w"></span>
<span class="err">├───────┼───────┼───────┼───────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">0.2</span><span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">0.4</span><span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">0.6</span><span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">0.8</span><span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="w"></span>
<span class="err">├───────┼───────┼───────┼───────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0.6</span><span class="w"> </span><span class="m">0.2</span><span class="err">│</span><span class="m">0.6</span><span class="w"> </span><span class="m">0.4</span><span class="err">│</span><span class="m">0.6</span><span class="w"> </span><span class="m">0.6</span><span class="err">│</span><span class="m">0.6</span><span class="w"> </span><span class="m">0.8</span><span class="err">│</span><span class="m">0.6</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="w"></span>
<span class="err">├───────┼───────┼───────┼───────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0.8</span><span class="w"> </span><span class="m">0.2</span><span class="err">│</span><span class="m">0.8</span><span class="w"> </span><span class="m">0.4</span><span class="err">│</span><span class="m">0.8</span><span class="w"> </span><span class="m">0.6</span><span class="err">│</span><span class="m">0.8</span><span class="w"> </span><span class="m">0.8</span><span class="err">│</span><span class="m">0.8</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="w"></span>
<span class="err">├───────┼───────┼───────┼───────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">0.2</span><span class="w">  </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">0.4</span><span class="w">  </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">0.6</span><span class="w">  </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">0.8</span><span class="w">  </span><span class="err">│</span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="err">│</span><span class="w"></span>
<span class="err">└───────┴───────┴───────┴───────┴─────┘</span><span class="w"></span>
<span class="w">       </span><span class="p">((</span><span class="o">⍳</span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="o">÷</span><span class="m">5</span><span class="p">)</span><span class="o">-⊂</span><span class="m">0.6</span><span class="w"> </span><span class="m">0.6</span><span class="w"></span>
<span class="w"> </span><span class="err">┌─────────┬─────────┬──────┬────────┬────────┐</span><span class="w"></span>
<span class="err">│</span><span class="m">¯0.4</span><span class="w"> </span><span class="m">¯0.4</span><span class="err">│</span><span class="m">¯0.4</span><span class="w"> </span><span class="m">¯0.2</span><span class="err">│</span><span class="m">¯0.4</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">¯0.4</span><span class="w"> </span><span class="m">0.2</span><span class="err">│</span><span class="m">¯0.4</span><span class="w"> </span><span class="m">0.4</span><span class="err">│</span><span class="w"></span>
<span class="err">├─────────┼─────────┼──────┼────────┼────────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">¯0.2</span><span class="w"> </span><span class="m">¯0.4</span><span class="err">│</span><span class="m">¯0.2</span><span class="w"> </span><span class="m">¯0.2</span><span class="err">│</span><span class="m">¯0.2</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">¯0.2</span><span class="w"> </span><span class="m">0.2</span><span class="err">│</span><span class="m">¯0.2</span><span class="w"> </span><span class="m">0.4</span><span class="err">│</span><span class="w"></span>
<span class="err">├─────────┼─────────┼──────┼────────┼────────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">¯0.4</span><span class="w">   </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">¯0.2</span><span class="w">   </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">   </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0.2</span><span class="w">   </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0.4</span><span class="w">   </span><span class="err">│</span><span class="w"></span>
<span class="err">├─────────┼─────────┼──────┼────────┼────────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">¯0.4</span><span class="w"> </span><span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">¯0.2</span><span class="w"> </span><span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">0.2</span><span class="w"> </span><span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">0.4</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">├─────────┼─────────┼──────┼────────┼────────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">¯0.4</span><span class="w"> </span><span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">¯0.2</span><span class="w"> </span><span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">0.2</span><span class="w"> </span><span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">0.4</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">└─────────┴─────────┴──────┴────────┴────────</span><span class="w"></span>
<span class="w">       </span><span class="nv">pxl_directions</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nv">pxl_coords</span><span class="o">÷≢</span><span class="nv">pxl_coords</span><span class="p">)</span><span class="o">-⊂</span><span class="m">0.6</span><span class="w"> </span><span class="m">0.6</span><span class="w"></span>
</code></pre></div>
<p>If we picture the image as being in front of the camera, with the camera facing the center of the image, we divide the values by the width/height, and shift them so that the vector 0 0 is at the center.</p>
<div class="highlight"><pre><span></span><code><span class="w">       </span><span class="o">,</span><span class="na">∘</span><span class="m">1</span><span class="na">¨</span><span class="p">(((</span><span class="o">⍳</span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="o">÷</span><span class="m">5</span><span class="p">)</span><span class="o">-⊂</span><span class="m">0.6</span><span class="w"> </span><span class="m">0.6</span><span class="p">)</span><span class="w"></span>
<span class="err">┌───────────┬───────────┬────────┬──────────┬──────────┐</span><span class="w"></span>
<span class="err">│</span><span class="m">¯0.4</span><span class="w"> </span><span class="m">¯0.4</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="m">¯0.4</span><span class="w"> </span><span class="m">¯0.2</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="m">¯0.4</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="m">¯0.4</span><span class="w"> </span><span class="m">0.2</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="m">¯0.4</span><span class="w"> </span><span class="m">0.4</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="w"></span>

<span class="err">├───────────┼───────────┼────────┼──────────┼──────────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">¯0.2</span><span class="w"> </span><span class="m">¯0.4</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="m">¯0.2</span><span class="w"> </span><span class="m">¯0.2</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="m">¯0.2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="m">¯0.2</span><span class="w"> </span><span class="m">0.2</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="m">¯0.2</span><span class="w"> </span><span class="m">0.4</span><span class="w"> </span><span class="m">1</span><span class="err">│</span><span class="w"></span>
<span class="err">├───────────┼───────────┼────────┼──────────┼──────────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">¯0.4</span><span class="w"> </span><span class="m">1</span><span class="w">   </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">¯0.2</span><span class="w"> </span><span class="m">1</span><span class="w">   </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w">   </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0.2</span><span class="w"> </span><span class="m">1</span><span class="w">   </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0.4</span><span class="w"> </span><span class="m">1</span><span class="w">   </span><span class="err">│</span><span class="w"></span>
<span class="err">├───────────┼───────────┼────────┼──────────┼──────────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">¯0.4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">¯0.2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">0.2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">0.2</span><span class="w"> </span><span class="m">0.4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">├───────────┼───────────┼────────┼──────────┼──────────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">¯0.4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">¯0.2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">0.2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="m">0.4</span><span class="w"> </span><span class="m">0.4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="err">│</span><span class="w"></span>
<span class="err">└───────────┴───────────┴────────┴──────────┴──────────┘</span><span class="w"></span>
<span class="w">       </span><span class="nv">pxl_directions</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">,</span><span class="na">∘</span><span class="m">1</span><span class="na">¨</span><span class="nv">pxl_directions</span><span class="w"> </span>
</code></pre></div>
<p>Where here, the each ¨ operator is used to apply the function (,∘1) to each element of the array. Remember, (,∘1) is binding the value 1 to the function (,), which means (,∘1)x is the same as (x,1).</p>
<p>Next, we have to calculate the intersection of our rays with the environment. One way is to do this is to keep moving along our rays in small steps until we are close enough to an object in the environment, which we detect using a function that returns the distance to the nearest object. This function should also return negative values for being inside the object, this function is usually called a signed distance function.</p>
<p>A more efficient solution is to use this distance function to move along our rays by the distance to the nearest object, guaranteeing first that we do not accidentally move beyond the nearest object while moving along our rays, and second that we approach these objects as quickly as possible. This approach is called “sphere tracing”.</p>
<figure>
<img src="../../assets/TeadrinkerVisualization.png" style="margin-left: auto; margin-right: auto; display: block;" />
<figcaption style="display:block; margin-left: auto; margin-right: auto;"> <a href="https://commons.wikimedia.org/wiki/User:Teadrinker">Teadrinker</a>, <a href="https://commons.wikimedia.org/wiki/File:Visualization_of_SDF_ray_marching_algorithm.png">Visualization of SDF ray marching algorithm</a>, <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode" rel="license">CC BY-SA 4.0</a> </figcaption>
</figure>

<p>We first setup the environment. The function for getting the distance between two points ⍺ and ⍵ in 3D space can be obtained using the Pythagorean theorem:</p>
<p><img src="../../assets/pythagorean.png" style="margin-left: auto; margin-right: auto; display: block;" /></p>
<div class="highlight"><pre><span></span><code><span class="w">           </span><span class="nv">dist</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">0.5</span><span class="o">*</span><span class="na">⍨</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="bp">⍺</span><span class="o">-</span><span class="bp">⍵</span><span class="p">)</span><span class="o">*</span><span class="m">2</span><span class="kt">}</span><span class="w"></span>
<span class="w">           </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="nv">dist</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="m">5</span><span class="w"></span>
</code></pre></div>
<p>The signed distance function for a sphere is immediate from the definition of a sphere as the set of points a distance R away from some center point C.</p>
<p><img src="../../assets/spheredistancefunction.png" style="margin-left: auto; margin-right: auto; display: block;" /></p>
<div class="highlight"><pre><span></span><code><span class="w">      </span><span class="nv">sphere</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="bp">⍵</span><span class="sr">[</span><span class="m">3</span><span class="sr">]</span><span class="w"> </span><span class="o">-</span><span class="na">⍨</span><span class="w"> </span><span class="bp">⍵</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w"> </span><span class="nv">dist</span><span class="w"> </span><span class="bp">⍵</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="kt">}</span><span class="w"></span>
<span class="w">       </span><span class="nv">R</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
<span class="w">       </span><span class="nv">C</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">       </span><span class="nv">P</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
<span class="w">       </span><span class="nv">sphere</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">R</span><span class="w"></span>
<span class="w">  </span><span class="m">2</span><span class="w"></span>
<span class="w">       </span><span class="nv">P</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
<span class="w">       </span><span class="nv">sphere</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">R</span><span class="w"></span>
<span class="w">  </span><span class="m">3</span><span class="w"></span>
</code></pre></div>
<p>Defining our environment as a sphere at the origin, we define the distance function for the environment.</p>
<div class="highlight"><pre><span></span><code><span class="w">       </span><span class="nv">env</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">C</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">sphere</span><span class="w"> </span><span class="bp">⍵</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">R</span><span class="kt">}</span><span class="w"></span>
<span class="w">       </span><span class="nv">P</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
<span class="w">       </span><span class="nv">env</span><span class="w"> </span><span class="nv">P</span><span class="w"></span>
<span class="m">3</span><span class="w"></span>
</code></pre></div>
<p>Let’s define the other functions we need and leave the marching function for last.</p>
<p>When a point on an object is hit by a ray, the color of that point needs to be calculated in order to make it into the final image. The main insight is that, at every point on the surface of an object, the lighting at that point depends on the angle between the light ray and the surface. For example, if the light ray hits the surface directly, so that it is parallel to the normal at that point, that point will be at the maximum brightness compared to points where the light ray does not hit exactly. If the light ray is perpendicular or makes a negative angle with the surface, then that part of the object is obscured.</p>
<p><img src="../../assets/lightraynormals.png" style="margin-left: auto; margin-right: auto; display: block;" /></p>
<p>We first normalise the vectors then take their dot product, this gives us the cosine of the angle between the two. Mathematically,</p>
<p><img src="../../assets/dotproduct.png" style="margin-left: auto; margin-right: auto; display: block;" /></p>
<p>We will use the cosine of the angle for shading, instead of using the angle explicitly.</p>
<div class="highlight"><pre><span></span><code><span class="w">       </span><span class="nv">length</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="na">∘</span><span class="nv">dist</span><span class="w"></span>
<span class="w">       </span><span class="nv">normalize</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⊢÷</span><span class="nv">length</span><span class="w"></span>
<span class="w">       </span><span class="nv">normalize</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">0.6</span><span class="w"> </span><span class="m">0.8</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</code></pre></div>
<p>The last function we will need is one which returns the normal to the environment at some point. Consider a point on the sphere. Intuitively, the vector orthogonal to the sphere will be the direction which makes the distance to the sphere increase the fastest, since every other direction either takes us towards the center of the sphere or away from the sphere at a slower rate</p>
<p><img src="../../assets/tangentspace.png" style="margin-left: auto; margin-right: auto; display: block;" /></p>
<p>We can construct this vector by calculating how much the distance function changes with a small variation in the x, y, and z directions, and normalizing the resulting vector. Small variations are needed so that we only consider points close to the surface point. In vector analysis terms, we are calculating the gradient of the distance function at that point.</p>
<div class="highlight"><pre><span></span><code><span class="w">       </span><span class="nv">small</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0.0001</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">       </span><span class="nv">P</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">         </span><span class="nv">Δenv_x</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nv">env</span><span class="w"> </span><span class="p">(</span><span class="nv">P</span><span class="o">+</span><span class="nv">small</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">env</span><span class="w"> </span><span class="p">(</span><span class="nv">P</span><span class="o">-</span><span class="nv">small</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="nv">Δenv_x</span><span class="w"></span>
<span class="m">0.0002</span><span class="w"></span>
</code></pre></div>
<p>We can use the rotate ⌽ operator to make the small vector in the y and z direction too.</p>
<div class="highlight"><pre><span></span><code><span class="w">       </span><span class="m">1</span><span class="w"> </span><span class="o">⌽</span><span class="w"> </span><span class="nv">small</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0.0001</span><span class="w"></span>
<span class="w">       </span><span class="p">(</span><span class="o">⌽</span><span class="na">∘</span><span class="p">(</span><span class="m">0.0001</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="na">¨</span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="err">┌──────────┬──────────┬──────────┐</span><span class="w"></span>
<span class="err">│</span><span class="m">0.0001</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0.0001</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0.0001</span><span class="err">│</span><span class="w"></span>
<span class="err">└──────────┴──────────┴──────────┘</span><span class="w"></span>
<span class="w">       </span><span class="o">⌽⍳</span><span class="m">3</span><span class="w"></span>
<span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">       </span><span class="p">(</span><span class="o">⌽</span><span class="na">∘</span><span class="nv">small</span><span class="p">)</span><span class="na">¨</span><span class="o">⌽⍳</span><span class="m">3</span><span class="w"></span>
<span class="err">┌──────────┬──────────┬──────────┐</span><span class="w"></span>
<span class="err">│</span><span class="m">0.0001</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0.0001</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0.0001</span><span class="err">│</span><span class="w"></span>
<span class="err">└──────────┴──────────┴──────────┘</span><span class="w"></span>
<span class="w">       </span><span class="nv">P</span><span class="w"> </span><span class="p">((</span><span class="nv">env</span><span class="o">+</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="nv">env</span><span class="o">-</span><span class="p">))</span><span class="na">⍨</span><span class="w"> </span><span class="nv">small</span><span class="w"></span>
<span class="m">0.0002</span><span class="w"></span>
<span class="w">       </span><span class="nv">P</span><span class="w"> </span><span class="p">((</span><span class="nv">env</span><span class="o">+</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="nv">env</span><span class="o">-</span><span class="p">))</span><span class="na">⍨</span><span class="p">((</span><span class="o">⌽</span><span class="na">∘</span><span class="p">(</span><span class="m">0.0001</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="na">¨</span><span class="o">⌽⍳</span><span class="m">3</span><span class="p">)</span><span class="w"></span>
<span class="err">┌──────────┐</span><span class="w"></span>
<span class="err">│</span><span class="m">0.0002</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="w"></span>
<span class="err">└──────────┘</span><span class="w"></span>
<span class="w">       </span><span class="o">⊃</span><span class="w"> </span><span class="nv">P</span><span class="w"> </span><span class="p">((</span><span class="nv">env</span><span class="o">+</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="nv">env</span><span class="o">-</span><span class="p">))</span><span class="na">⍨</span><span class="p">((</span><span class="o">⌽</span><span class="na">∘</span><span class="p">(</span><span class="m">0.0001</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="na">¨</span><span class="o">⌽⍳</span><span class="m">3</span><span class="p">)</span><span class="w"></span>
<span class="m">0.0002</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">       </span><span class="nv">norm</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">normalize</span><span class="w"> </span><span class="o">⊃</span><span class="w"> </span><span class="bp">⍵</span><span class="w"> </span><span class="p">((</span><span class="nv">env</span><span class="o">+</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="nv">env</span><span class="o">-</span><span class="p">))</span><span class="na">⍨</span><span class="p">((</span><span class="o">⌽</span><span class="na">∘</span><span class="p">(</span><span class="m">0.0001</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="na">¨</span><span class="o">⌽⍳</span><span class="m">3</span><span class="p">)</span><span class="kt">}</span><span class="w"></span>
<span class="w">       </span><span class="nv">norm</span><span class="w"> </span><span class="nv">P</span><span class="w"></span>
<span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
</code></pre></div>
<p>Finally, we are now ready to write the ray marching function. The marching function should take the camera’s initial position, and move it along a ray according to the distance function for either a maximum number of marches or a point is hit, and for the latter return the dot product of the normal at that point with the vector from that point to the light source.</p>
<div class="highlight"><pre><span></span><code><span class="w">       </span><span class="nv">march</span><span class="kd">←</span><span class="p">(</span><span class="kt">{</span><span class="nv">cur_pos</span><span class="kd">←</span><span class="o">⊃</span><span class="bp">⍵</span><span class="w"> </span>
<span class="w">            </span><span class="p">⋄</span><span class="w"> </span><span class="nv">ray</span><span class="kd">←</span><span class="m">2</span><span class="o">⊃</span><span class="bp">⍵</span><span class="w"></span>
<span class="w">            </span><span class="p">⋄</span><span class="w"> </span><span class="nv">i</span><span class="kd">←</span><span class="m">3</span><span class="o">⊃</span><span class="bp">⍵</span><span class="w"> </span>
<span class="w">            </span><span class="p">⋄</span><span class="w"> </span><span class="nv">cur_pos</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">cur_pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">env</span><span class="w"> </span><span class="nv">cur_pos</span><span class="p">)</span><span class="o">×</span><span class="nv">ray</span><span class="w"> </span>
<span class="w">            </span><span class="p">⋄</span><span class="w"> </span><span class="p">(</span><span class="nv">env</span><span class="w"> </span><span class="nv">cur_pos</span><span class="p">)</span><span class="o">&lt;</span><span class="m">0.0001</span><span class="bp">:</span><span class="m">0</span><span class="o">⌈</span><span class="p">(</span><span class="nv">norm</span><span class="w"> </span><span class="nv">cur_pos</span><span class="p">)(</span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="p">)(</span><span class="nv">normalize</span><span class="w"> </span><span class="nv">cur_pos</span><span class="o">-</span><span class="nv">light</span><span class="p">)</span><span class="w">   </span>
<span class="w">            </span><span class="p">⋄</span><span class="w">  </span><span class="nv">cur_pos</span><span class="w"> </span><span class="nv">ray</span><span class="w"> </span><span class="p">(</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="kt">}</span><span class="na">⍣</span><span class="kt">{</span><span class="p">(</span><span class="m">1</span><span class="o">=≢</span><span class="bp">⍺</span><span class="p">)</span><span class="o">∨</span><span class="p">((</span><span class="bp">⍺</span><span class="o">,</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="sr">[</span><span class="m">3</span><span class="sr">]</span><span class="o">&gt;</span><span class="m">32</span><span class="p">)</span><span class="kt">}</span><span class="p">)</span><span class="w"></span>

<span class="w">       </span><span class="nv">camera</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">¯10</span><span class="w"></span>
<span class="w">       </span><span class="nv">ray</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">       </span><span class="nv">light</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"></span>
<span class="w">       </span><span class="nv">march</span><span class="w"> </span><span class="nv">camera</span><span class="w"> </span><span class="nv">ray</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">0.8571428571</span><span class="w"></span>
<span class="w">       </span><span class="nv">march</span><span class="w"> </span><span class="nv">camera</span><span class="w"> </span><span class="p">(</span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="err">┌────────────────────┬─────┬──┐</span><span class="w"></span>
<span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">3.969795284E10</span><span class="w"> </span><span class="m">¯10</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">33</span><span class="err">│</span><span class="w"></span>
<span class="err">└────────────────────┴─────┴──┘</span><span class="w"></span>
</code></pre></div>
<p>Let’s go through the above code step by step.</p>
<p>The function takes in a three element nested array, the first being the camera position, the second is the ray to march along, and the third is a counter variable. It starts from the camera position and adds to it the distance to the environment times the ray. If the distance to the environment is less than a small value, then it returns the dot product of the vector to the light source with the normal to the environment at that point, or zero, depending on which is greater. If not, then it returns the current position, ray, and counter incremented by one.</p>
<p>The power operator f⍣g allows us to evaluate the function f until the function g returns a value of 1. The function g takes in the previous return value of f, and the current return value of f, as left and right arguments. </p>
<p>Here, the march function keeps moving the current position along the ray until either the result is a single value, that is, if the if statement in the march function returns either 0 or the dot product, by checking the number of elements (1=≢⍺), or if the number of iterations exceeds 32, ⍺[3]&gt;32.</p>
<p>Wrapping the march function in a function that returns zero if the result is not a single number, we apply the function to the pixel coordinates and store the result.</p>
<div class="highlight"><pre><span></span><code><span class="w">       </span><span class="nv">color</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">i</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">march</span><span class="w"> </span><span class="nv">camera</span><span class="w"> </span><span class="bp">⍵</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="m">1</span><span class="o">=≢</span><span class="nv">i</span><span class="bp">:</span><span class="nv">i</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="m">0</span><span class="kt">}</span><span class="w"></span>
<span class="w">       </span><span class="nv">color</span><span class="w"> </span><span class="p">(</span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"></span>
<span class="m">0</span><span class="w"></span>
<span class="w">       </span><span class="nv">color</span><span class="na">¨</span><span class="p">(</span><span class="o">,</span><span class="na">∘</span><span class="m">1</span><span class="na">¨</span><span class="p">((</span><span class="o">⍳</span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="o">÷</span><span class="m">5</span><span class="p">)</span><span class="o">-⊂</span><span class="m">0.6</span><span class="w"> </span><span class="m">0.6</span><span class="p">)</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">            </span><span class="m">0</span><span class="w">            </span><span class="m">0</span><span class="w">           </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">            </span><span class="m">0.7893982995</span><span class="w"> </span><span class="m">0</span><span class="w">           </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0.8900597217</span><span class="w"> </span><span class="m">0.8571428571</span><span class="w"> </span><span class="m">0.145402276</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">            </span><span class="m">0.3004347993</span><span class="w"> </span><span class="m">0</span><span class="w">           </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">            </span><span class="m">0</span><span class="w">            </span><span class="m">0</span><span class="w">           </span><span class="m">0</span><span class="w"></span>
<span class="w">       </span><span class="nv">image</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">color</span><span class="na">¨</span><span class="nv">pxl_directions</span><span class="w"></span>
</code></pre></div>
<p>This calculation might take a couple seconds.</p>
<p>To actually see our rendered image, we need to export our array as an image file. We will be using the very simple PPM file format, in which images are plain text files. The header of a PPM file consists of a format indicator “P3”, the size of the image (5 5), the maximum value for each color (255), and the colors in RGB format. Using the ⎕NPUT function with the append (2) argument, we write to a file called “image.ppm”. We use the encode <code>⍕</code> operator to convert between numerical arrays to character arrays.</p>
<div class="highlight"><pre><span></span><code><span class="w">       </span><span class="s1">&#39;P3&#39;</span><span class="nf">⎕NPUT</span><span class="s1">&#39;image.ppm&#39;</span><span class="m">2</span><span class="w"></span>
<span class="w">       </span><span class="p">(</span><span class="o">⍕⍴</span><span class="nv">image</span><span class="p">)</span><span class="nf">⎕NPUT</span><span class="s1">&#39;image.ppm&#39;</span><span class="m">2</span><span class="w"></span>
<span class="w">       </span><span class="s1">&#39;255&#39;</span><span class="nf">⎕NPUT</span><span class="s1">&#39;image.ppm&#39;</span><span class="m">2</span><span class="w"></span>

<span class="w">       </span><span class="nv">test</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">color</span><span class="na">¨</span><span class="p">(</span><span class="o">,</span><span class="na">∘</span><span class="m">1</span><span class="na">¨</span><span class="p">((</span><span class="o">⍳</span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="o">÷</span><span class="m">5</span><span class="p">)</span><span class="o">-⊂</span><span class="m">0.6</span><span class="w"> </span><span class="m">0.6</span><span class="p">)</span><span class="w"></span>
<span class="w">       </span><span class="nv">test</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">            </span><span class="m">0</span><span class="w">            </span><span class="m">0</span><span class="w">           </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">            </span><span class="m">0.7893982995</span><span class="w"> </span><span class="m">0</span><span class="w">           </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0.8900597217</span><span class="w"> </span><span class="m">0.8571428571</span><span class="w"> </span><span class="m">0.145402276</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">            </span><span class="m">0.3004347993</span><span class="w"> </span><span class="m">0</span><span class="w">           </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">            </span><span class="m">0</span><span class="w">            </span><span class="m">0</span><span class="w">           </span><span class="m">0</span><span class="w"></span>

<span class="w">       </span><span class="nv">test</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">⌈</span><span class="na">¨</span><span class="m">255</span><span class="o">×</span><span class="p">(</span><span class="nv">test</span><span class="p">)</span><span class="w"></span>
<span class="w">       </span><span class="nv">test</span><span class="w"></span>
<span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w"> </span><span class="m">202</span><span class="w">  </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">227</span><span class="w"> </span><span class="m">219</span><span class="w"> </span><span class="m">38</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">77</span><span class="w">  </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">       </span><span class="o">,</span><span class="na">∘</span><span class="p">(</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="na">¨</span><span class="nv">test</span><span class="w"></span>
<span class="err">┌─────┬───────┬───────┬──────┬─────┐</span><span class="w"></span>
<span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="w"></span>
<span class="err">├─────┼───────┼───────┼──────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="err">│</span><span class="m">202</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="w"></span>
<span class="err">├─────┼───────┼───────┼──────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">227</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">219</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">38</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="w"></span>
<span class="err">├─────┼───────┼───────┼──────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="err">│</span><span class="m">77</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="w"></span>
<span class="err">├─────┼───────┼───────┼──────┼─────┤</span><span class="w"></span>
<span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="w"></span>
<span class="err">└─────┴───────┴───────┴──────┴─────┘</span><span class="w"></span>

<span class="w">       </span><span class="o">,</span><span class="na">/</span><span class="nv">test</span><span class="w"></span>
<span class="err">┌─────────┬───────────┬──────────────┬──────────┬─────────┐</span><span class="w"></span>
<span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">202</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">227</span><span class="w"> </span><span class="m">219</span><span class="w"> </span><span class="m">38</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">77</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="err">│</span><span class="w"></span>
<span class="err">└─────────┴───────────┴──────────────┴──────────┴─────────┘</span><span class="w"></span>

<span class="w">       </span><span class="nv">image</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="o">,</span><span class="na">∘</span><span class="p">(</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="na">¨</span><span class="p">(</span><span class="o">⌈</span><span class="na">¨</span><span class="m">255</span><span class="o">×</span><span class="nv">image</span><span class="p">)</span><span class="w"></span>
<span class="w">       </span><span class="p">((</span><span class="s1">&#39;image.ppm&#39;</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="na">∘</span><span class="p">(</span><span class="nf">⎕NPUT</span><span class="na">⍨</span><span class="p">)</span><span class="o">⍕</span><span class="p">)</span><span class="na">¨</span><span class="o">,</span><span class="na">/</span><span class="nv">image</span><span class="w"></span>
</code></pre></div>
<p>Opening the file in a compatible program, such as the GIMP image editor, we see the beautifully shaded sphere.</p>
<p><img src="../../assets/sphere.png" style="margin-left: auto; margin-right: auto; display: block;" /></p>
<p>By changing the distance function of the world, it is possible to render more complex objects. Take for example, the distance function for a torus.</p>
<div class="highlight"><pre><span></span><code><span class="w">       </span><span class="nv">torus</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="nv">r</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍺</span><span class="w"> </span><span class="p">⋄</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="w"></span>
<span class="w">              </span><span class="p">⋄</span><span class="w"> </span><span class="nv">q</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="p">(</span><span class="nv">r</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="o">-</span><span class="na">⍨</span><span class="nv">length</span><span class="w"> </span><span class="nv">p</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="o">,</span><span class="nv">p</span><span class="sr">[</span><span class="m">3</span><span class="sr">]</span><span class="p">)</span><span class="o">,</span><span class="nv">p</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="w"></span>
<span class="w">              </span><span class="p">⋄</span><span class="w"> </span><span class="nv">r</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">-</span><span class="na">⍨</span><span class="nv">length</span><span class="w"> </span><span class="nv">q</span><span class="w">               </span>
<span class="w">              </span><span class="kt">}</span><span class="w"></span>
<span class="w">       </span><span class="nv">env</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="m">1</span><span class="w"> </span><span class="m">0.5</span><span class="w"> </span><span class="nv">torus</span><span class="w"> </span><span class="bp">⍵</span><span class="kt">}</span><span class="w"></span>
</code></pre></div>
<p><img src="../../assets/torus.png" style="margin-left: auto; margin-right: auto; display: block;" /></p>
<p>There are also ways of combining distance functions to create more complex scenes, such as taking the minimum of two distance functions. However, we will leave the creation of more complex 3D scenes to the interested reader.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../part3/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 3.3 - All Aboard" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              3.3 - All Aboard
            </div>
          </div>
        </a>
      
      
        
        <a href="../../../credits/" class="md-footer__link md-footer__link--next" aria-label="Next: Receiving ECTS Credits" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Receiving ECTS Credits
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "nagivation.top", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.078830c0.min.js"></script>
      
        <script src="../../../js/mooc.js"></script>
      
        <script src="../../../js/languagebar.js"></script>
      
    
  </body>
</html>